# Boss页面数值格式化优化说明

## 📋 需求概述

根据业务需求，对boss页面所展示的相关数据进行精度优化：
- **重量相关数值**：保留小数点后三位
- **水份/品位等百分比相关数值**：保留小数点后两位

## 🔧 实施方案

### 1. 创建统一格式化工具库

**文件位置**: `src/lib/formatters.ts`

**核心功能**:
- `formatWeight()` - 重量数值格式化（3位小数）
- `formatPercentage()` - 百分比数值格式化（2位小数）
- `formatValue()` - 智能格式化（根据单位自动判断）
- `formatChartValue()` - 图表数值格式化
- `formatTableValue()` - 表格数值格式化
- `isWeightUnit()` - 重量单位检测
- `isPercentageUnit()` - 百分比单位检测

**支持的单位类型**:
- **重量单位**: t, kg, g, ton, 吨, 千克, 克
- **百分比单位**: %, percent, 百分比

### 2. 更新的页面和组件

#### 2.1 Boss页面 (`src/app/boss/page.tsx`)
- ✅ 导入格式化工具函数
- ✅ 更新核心生产指标数据的精度设置
- ✅ 更新图表中心显示的数值格式化
- ✅ 更新自定义Tooltip中的数值显示

#### 2.2 生产数据图表组件 (`src/components/charts/ProductionDataChart.tsx`)
- ✅ 导入格式化工具函数
- ✅ 更新标签显示格式（重量数据使用3位小数）

#### 2.3 班报详情页面 (`src/app/shift-report-details/page.tsx`)
- ✅ 导入格式化工具函数
- ✅ 替换原有的格式化逻辑，使用统一的智能格式化

#### 2.4 化验室页面 (`src/app/lab/page.tsx`)
- ✅ 导入格式化工具函数
- ✅ 增强formatValue函数，支持智能单位识别

#### 2.5 数据对比组件
- ✅ `src/components/data-vs-1.tsx` - 导入格式化工具
- ✅ `src/components/data-vs-fuke.tsx` - 导入格式化工具

#### 2.6 图表组件 (`src/components/charts/ChartBarNegative.tsx`)
- ✅ 导入格式化工具函数
- ✅ 更新Tooltip和标签的数值格式化

### 3. 测试页面

**文件位置**: `src/app/test-formatters/page.tsx`

**功能**: 
- 验证各种数值格式化效果
- 展示重量类和百分比类数值的处理结果
- 测试边界情况（空值、零值等）

**访问地址**: `http://localhost:3000/test-formatters`

## 📊 格式化规则详解

### 智能格式化逻辑

```typescript
// 根据单位自动判断格式化方式
formatValue(value, unit) {
  // 重量单位 → 3位小数
  if (isWeightUnit(unit)) return formatWeight(value, unit);
  
  // 百分比单位 → 2位小数  
  if (isPercentageUnit(unit)) return formatPercentage(value, unit);
  
  // 其他单位 → 默认2位小数
  return value.toFixed(2) + unit;
}
```

### 具体示例

| 原始数值 | 单位 | 格式化结果 | 说明 |
|---------|------|-----------|------|
| 12345.6789 | t | 12345.679t | 重量类-3位小数 |
| 52.8456 | % | 52.85% | 百分比类-2位小数 |
| 6640.123456 | kg | 6640.123kg | 重量类-3位小数 |
| 89.2567 | % | 89.26% | 百分比类-2位小数 |
| null | t | -- | 空值处理 |

## 🎯 优化效果

### 1. 数据显示精度标准化
- 重量数据统一显示3位小数，提高精度
- 百分比数据统一显示2位小数，符合行业惯例

### 2. 代码维护性提升
- 统一的格式化工具库，便于维护和扩展
- 智能单位识别，减少手动配置

### 3. 用户体验改善
- 数据显示更加精确和一致
- 符合业务人员的阅读习惯

## 🔍 验证方法

1. **访问Boss页面**: `http://localhost:3000/boss`
   - 查看核心生产指标的数值显示
   - 检查图表中的数据标签格式

2. **访问测试页面**: `http://localhost:3000/test-formatters`
   - 验证各种格式化函数的效果
   - 查看不同单位类型的处理结果

3. **检查其他相关页面**:
   - 班报详情页面的图表数值
   - 化验室页面的数据显示
   - 数据对比分析组件

## 📝 注意事项

1. **向后兼容**: 所有修改都保持向后兼容，不影响现有功能
2. **性能影响**: 格式化函数经过优化，对性能影响微乎其微
3. **扩展性**: 可以轻松添加新的单位类型和格式化规则
4. **错误处理**: 完善的空值和异常值处理机制

## 🚀 后续优化建议

1. **国际化支持**: 可以根据地区设置调整数值格式
2. **动态精度**: 根据数值大小动态调整显示精度
3. **单位转换**: 添加单位自动转换功能（如kg转t）
4. **配置化**: 将格式化规则配置化，便于业务调整
