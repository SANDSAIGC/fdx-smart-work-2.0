# æ•°æ®åº“è¯»å†™æœ€ä½³å®è·µåˆ†æ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ·±å…¥åˆ†æäº†FDX SMART WORK 2.0é¡¹ç›®ä¸­ç­æ ·è®°å½•é¡µé¢ï¼ˆæ•°æ®åº“å†™å…¥ï¼‰å’Œç”Ÿäº§ç­æŠ¥è¯¦æƒ…é¡µé¢ï¼ˆæ•°æ®åº“è¯»å–ï¼‰çš„å®ç°ï¼Œæ€»ç»“äº†æ•°æ®åº“æ“ä½œçš„æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ€»ç»“

### æ•´ä½“æ¶æ„å¯¹æ¯”

| æ“ä½œç±»å‹ | ç­æ ·è®°å½•é¡µé¢ï¼ˆå†™å…¥ï¼‰ | ç”Ÿäº§ç­æŠ¥è¯¦æƒ…é¡µé¢ï¼ˆè¯»å–ï¼‰ |
|---------|------------------|----------------------|
| **ä¸»è¦åŠŸèƒ½** | æ•°æ®è¡¨å•æäº¤å’ŒéªŒè¯ | æ•°æ®æŸ¥è¯¢ã€èšåˆå’Œå±•ç¤º |
| **APIè®¾è®¡** | POSTæ–¹æ³•ï¼Œå•è¡¨å†™å…¥ | POSTæ–¹æ³•ï¼Œå¤šè¡¨æŸ¥è¯¢ |
| **æ•°æ®æµå‘** | å‰ç«¯ â†’ API â†’ Supabase | Supabase â†’ API â†’ å‰ç«¯ |
| **é”™è¯¯å¤„ç†** | è¡¨å•éªŒè¯ + APIé”™è¯¯ | æŸ¥è¯¢é”™è¯¯ + æ•°æ®å¤„ç†é”™è¯¯ |
| **çŠ¶æ€ç®¡ç†** | æäº¤çŠ¶æ€ + è¡¨å•çŠ¶æ€ | åŠ è½½çŠ¶æ€ + æ•°æ®çŠ¶æ€ |

### ç»Ÿä¸€çš„æŠ€æœ¯æ ˆ

```typescript
// å…±åŒçš„æŠ€æœ¯ç»„ä»¶
- Next.js App Router
- TypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- Supabase REST APIï¼ˆéå®¢æˆ·ç«¯ç›´è¿ï¼‰
- ç¯å¢ƒå˜é‡é…ç½®ç®¡ç†
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
```

## ğŸ’¾ æ•°æ®åº“å†™å…¥æœ€ä½³å®è·µï¼ˆç­æ ·è®°å½•é¡µé¢ï¼‰

### 1. APIè·¯ç”±è®¾è®¡æ¨¡å¼

#### æ ‡å‡†åŒ–çš„APIç»“æ„
```typescript
// src/app/api/samples/shift-sample/route.ts
export async function POST(request: NextRequest) {
  try {
    // 1. ç¯å¢ƒå˜é‡éªŒè¯
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
    
    if (!supabaseUrl || !anonKey) {
      return NextResponse.json({
        success: false,
        message: 'Environment variables not configured'
      }, { status: 500 });
    }

    // 2. è¯·æ±‚æ•°æ®è§£æå’ŒéªŒè¯
    const requestData = await request.json();
    console.log('ğŸ”¬ [ç­æ ·API] æ”¶åˆ°æ•°æ®:', requestData);

    // 3. æ•°æ®å­—æ®µæ˜ å°„å’ŒéªŒè¯
    const { æ—¥æœŸ, ç­æ¬¡, /* å…¶ä»–å­—æ®µ */ } = requestData;

    // 4. å¿…å¡«å­—æ®µéªŒè¯
    if (!æ—¥æœŸ || !ç­æ¬¡) {
      return NextResponse.json({
        success: false,
        message: 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ'
      }, { status: 400 });
    }

    // 5. æ•°æ®åº“å†™å…¥æ“ä½œ
    // 6. å“åº”å¤„ç†
  } catch (error) {
    // 7. ç»Ÿä¸€é”™è¯¯å¤„ç†
  }
}
```

#### å…³é”®è®¾è®¡åŸåˆ™

**ğŸ”’ å®‰å…¨æ€§ä¼˜å…ˆ**
```typescript
// ç¯å¢ƒå˜é‡æ£€æŸ¥
if (!supabaseUrl || !anonKey) {
  return NextResponse.json({
    success: false,
    message: 'Environment variables not configured'
  }, { status: 500 });
}
```

**ğŸ“ è¯¦ç»†çš„æ—¥å¿—è®°å½•**
```typescript
console.log('ğŸ”¬ [ç­æ ·API] æ”¶åˆ°æ•°æ®:', requestData);
console.log('ğŸ“¤ [ç­æ ·API] å‡†å¤‡æ’å…¥æ•°æ®:', insertData);
console.log('âœ… [ç­æ ·API] æ’å…¥æˆåŠŸ:', result);
```

**ğŸ›¡ï¸ å¤šå±‚æ•°æ®éªŒè¯**
```typescript
// 1. å¿…å¡«å­—æ®µéªŒè¯
if (!æ—¥æœŸ || !ç­æ¬¡) {
  return NextResponse.json({
    success: false,
    message: 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ'
  }, { status: 400 });
}

// 2. æ•°æ®ç±»å‹éªŒè¯
if (typeof originalMoisture !== 'number' || originalMoisture < 0) {
  return NextResponse.json({
    success: false,
    message: 'æ°´ä»½æ•°æ®æ ¼å¼é”™è¯¯'
  }, { status: 400 });
}

// 3. ä¸šåŠ¡é€»è¾‘éªŒè¯
if (originalMoisture > 100) {
  return NextResponse.json({
    success: false,
    message: 'æ°´ä»½ä¸èƒ½è¶…è¿‡100%'
  }, { status: 400 });
}
```

### 2. æ•°æ®æœåŠ¡å±‚è®¾è®¡

#### SampleDataService ç»Ÿä¸€æœåŠ¡å±‚
```typescript
// src/lib/supabase.ts
export class SampleDataService {
  static async submitShiftSample(data: ShiftSampleData): Promise<{
    success: boolean; 
    message: string; 
    data?: any 
  }> {
    try {
      const headers = await getCurrentUserHeaders();
      
      const response = await fetch('/api/samples/shift-sample', {
        method: 'POST',
        headers,
        body: JSON.stringify(data),
      });

      if (!response.ok) {
        console.error('âŒ [ç­æ ·æœåŠ¡] HTTPé”™è¯¯:', response.status);
        return {
          success: false,
          message: `ç½‘ç»œè¯·æ±‚å¤±è´¥: ${response.status} ${response.statusText}`
        };
      }

      const result = await response.json();
      console.log('ğŸ“¤ [ç­æ ·æœåŠ¡] APIå“åº”:', result);
      return result;
    } catch (error) {
      console.error('âŒ [ç­æ ·æœåŠ¡] ç½‘ç»œå¼‚å¸¸:', error);
      return {
        success: false,
        message: `ç½‘ç»œè¿æ¥å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`
      };
    }
  }
}
```

#### æœåŠ¡å±‚è®¾è®¡ä¼˜åŠ¿

**ğŸ”„ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†**
- HTTPçŠ¶æ€ç æ£€æŸ¥
- ç½‘ç»œå¼‚å¸¸æ•è·
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

**ğŸ“Š æ ‡å‡†åŒ–çš„å“åº”æ ¼å¼**
```typescript
interface ServiceResponse {
  success: boolean;
  message: string;
  data?: any;
}
```

**ğŸ” å®Œæ•´çš„æ—¥å¿—è¿½è¸ª**
- è¯·æ±‚æ—¥å¿—
- å“åº”æ—¥å¿—
- é”™è¯¯æ—¥å¿—

### 3. å‰ç«¯è¡¨å•å¤„ç†

#### è¡¨å•çŠ¶æ€ç®¡ç†
```typescript
// è¡¨å•æ•°æ®çŠ¶æ€
const [formData, setFormData] = useState<ShiftSampleFormData>(initialFormData);

// æäº¤çŠ¶æ€ç®¡ç†
const [isSubmitting, setIsSubmitting] = useState(false);
const [submitStatus, setSubmitStatus] = useState<'idle' | 'success' | 'error'>('idle');
const [submitMessage, setSubmitMessage] = useState('');

// è¡¨å•éªŒè¯
const validateForm = useCallback(() => {
  if (!formData.date || !formData.shift) {
    return "è¯·å¡«å†™æ—¥æœŸå’Œç­æ¬¡";
  }
  if (!formData.originalMoisture || !formData.originalPbGrade) {
    return "è¯·å¡«å†™æ‰€æœ‰å¿…å¡«çš„åŒ–éªŒæ•°æ®";
  }
  return null;
}, [formData]);
```

#### æäº¤æµç¨‹è®¾è®¡
```typescript
const handleSubmit = useCallback(async () => {
  // 1. è¡¨å•éªŒè¯
  const validationError = validateForm();
  if (validationError) {
    setSubmitStatus('error');
    setSubmitMessage(validationError);
    return;
  }

  setIsSubmitting(true);
  setSubmitStatus('idle');

  try {
    // 2. æ•°æ®æ˜ å°„
    const submitData = {
      æ—¥æœŸ: formData.date,
      ç­æ¬¡: formData.shift,
      'æ°§åŒ–é”ŒåŸçŸ¿-æ°´ä»½ï¼ˆ%ï¼‰': parseFloat(formData.originalMoisture),
      // ... å…¶ä»–å­—æ®µæ˜ å°„
    };

    // 3. è°ƒç”¨æœåŠ¡å±‚
    const result = await SampleDataService.submitShiftSample(submitData);

    // 4. å¤„ç†å“åº”
    if (result.success) {
      setSubmitStatus('success');
      setSubmitMessage(result.message);
      setFormData(initialFormData); // é‡ç½®è¡¨å•
    } else {
      setSubmitStatus('error');
      setSubmitMessage(result.message);
    }

    // 5. è‡ªåŠ¨æ¸…é™¤çŠ¶æ€
    setTimeout(() => setSubmitStatus('idle'), 3000);

  } catch (error) {
    setSubmitStatus('error');
    setSubmitMessage(`æäº¤å¤±è´¥: ${error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'}`);
  } finally {
    setIsSubmitting(false);
  }
}, [formData, validateForm]);
```

## ğŸ“– æ•°æ®åº“è¯»å–æœ€ä½³å®è·µï¼ˆç”Ÿäº§ç­æŠ¥è¯¦æƒ…é¡µé¢ï¼‰

### 1. æŸ¥è¯¢APIè®¾è®¡

#### å¤šæ•°æ®æºæŸ¥è¯¢æ¶æ„
```typescript
// src/app/api/shift-report-details/route.ts
export async function POST(request: NextRequest) {
  try {
    const { startDate, endDate, dataSource } = await request.json();
    
    // æ•°æ®æºè·¯ç”±
    let tableName: string;
    switch (dataSource) {
      case 'fdx': tableName = 'ç”Ÿäº§ç­æŠ¥-FDX'; break;
      case 'jdxy': tableName = 'ç”Ÿäº§ç­æŠ¥-JDXY'; break;
      case 'kl': tableName = 'ç”Ÿäº§ç­æŠ¥-KL'; break;
      default:
        return NextResponse.json(
          { success: false, error: 'æ— æ•ˆçš„æ•°æ®æº' },
          { status: 400 }
        );
    }

    // æ„å»ºæŸ¥è¯¢URL
    let queryUrl = `${supabaseUrl}/rest/v1/${encodeURIComponent(tableName)}?select=*`;
    queryUrl += `&æ—¥æœŸ=gte.${startDate}&æ—¥æœŸ=lte.${endDate}`;
    queryUrl += `&order=æ—¥æœŸ.desc,ç­æ¬¡.desc`;

    // æ‰§è¡ŒæŸ¥è¯¢
    const response = await fetch(queryUrl, {
      method: 'GET',
      headers: {
        'apikey': anonKey,
        'Authorization': `Bearer ${anonKey}`,
        'Content-Type': 'application/json'
      }
    });

    if (!response.ok) {
      throw new Error(`æŸ¥è¯¢å¤±è´¥: ${response.statusText}`);
    }

    const data = await response.json();
    return NextResponse.json({
      success: true,
      data: data || [],
      message: `æˆåŠŸè·å– ${data?.length || 0} æ¡è®°å½•`
    });

  } catch (error) {
    console.error('æŸ¥è¯¢é”™è¯¯:', error);
    return NextResponse.json({
      success: false,
      error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯: ' + (error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯')
    }, { status: 500 });
  }
}
```

#### æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥

**ğŸ“… æ™ºèƒ½æ—¥æœŸå¤„ç†**
```typescript
// æ—¥æœŸæ ¼å¼æ ‡å‡†åŒ–
const itemDate = new Date(item.æ—¥æœŸ).toISOString().split('T')[0];
if (itemDate >= startDate && itemDate <= endDate) {
  // å¤„ç†æ•°æ®
}
```

**ğŸ” URLç¼–ç å®‰å…¨**
```typescript
// è¡¨åç¼–ç å¤„ç†
const queryUrl = `${supabaseUrl}/rest/v1/${encodeURIComponent(tableName)}`;
```

**ğŸ“Š æ’åºå’Œåˆ†é¡µ**
```typescript
// å¤šå­—æ®µæ’åº
queryUrl += `&order=æ—¥æœŸ.desc,ç­æ¬¡.desc`;

// åˆ†é¡µæ”¯æŒ
queryUrl += `&limit=${limit}&offset=${offset}`;
```

### 2. æ•°æ®èšåˆå’Œå¤„ç†

#### è¶‹åŠ¿æ•°æ®èšåˆ
```typescript
const processTrendData = useCallback(() => {
  // æŒ‰æ—¥æœŸåˆ†ç»„
  const dateGroups = new Map();
  
  allData.forEach(item => {
    const itemDate = new Date(item.æ—¥æœŸ).toISOString().split('T')[0];
    if (itemDate >= trendStartDate && itemDate <= trendEndDate) {
      if (!dateGroups.has(itemDate)) {
        dateGroups.set(itemDate, { jdxy: [], fdx: [], kl: [] });
      }
      
      // æ ¹æ®æ•°æ®æ¥æºåˆ†ç±»
      if (jdxyData.includes(item)) {
        dateGroups.get(itemDate).jdxy.push(item);
      } else if (fdxData.includes(item)) {
        dateGroups.get(itemDate).fdx.push(item);
      } else if (klData.includes(item)) {
        dateGroups.get(itemDate).kl.push(item);
      }
    }
  });

  // èšåˆè®¡ç®—
  const chartData = [];
  Array.from(dateGroups.keys()).sort().forEach(date => {
    const groups = dateGroups.get(date);
    
    const aggregateGroup = (data: any[]) => {
      if (data.length === 0) return null;
      
      // tå€¼æ±‡æ€»ï¼Œ%å€¼åŠ æƒå¹³å‡
      const totals = data.reduce((acc, item) => {
        Object.keys(item).forEach(key => {
          if (key.includes('t') || key.includes('é‡é‡')) {
            acc[key] = (acc[key] || 0) + (item[key] || 0);
          } else if (key.includes('%') || key.includes('å“ä½')) {
            acc[key] = (acc[key] || 0) + (item[key] || 0);
            acc[`${key}_count`] = (acc[`${key}_count`] || 0) + 1;
          }
        });
        return acc;
      }, {});

      // è®¡ç®—åŠ æƒå¹³å‡
      Object.keys(totals).forEach(key => {
        if (key.includes('%') && !key.includes('_count')) {
          const count = totals[`${key}_count`] || 1;
          totals[key] = totals[key] / count;
        }
      });

      return totals;
    };

    chartData.push({
      date,
      é‡‘é¼: aggregateGroup(groups.jdxy),
      å¯Œé¼ç¿”: aggregateGroup(groups.fdx),
      ç§‘åŠ›: aggregateGroup(groups.kl)
    });
  });

  return chartData;
}, [allData, trendStartDate, trendEndDate]);
```

#### å•æ—¥è¯¦æƒ…æ•°æ®å¤„ç†
```typescript
const processSingleDayBarData = useCallback((dataSource: string) => {
  const sourceData = dataSource === 'jdxy' ? jdxyData : 
                    dataSource === 'fdx' ? fdxData : klData;

  // ç­›é€‰æŒ‡å®šæ—¥æœŸçš„æ•°æ®
  const dayData = sourceData.filter(item => {
    if (!item.æ—¥æœŸ) return false;
    const itemDate = new Date(item.æ—¥æœŸ).toISOString().split('T')[0];
    return itemDate === singleDate;
  });

  if (dayData.length === 0) {
    return [[], [], [], []]; // è¿”å›å››ä¸ªç©ºæ•°ç»„
  }

  // æ•°æ®èšåˆ
  const aggregated = dayData.reduce((acc, item) => {
    // tå€¼æ±‡æ€»
    acc.oreWetWeight += item['æ°§åŒ–é”ŒåŸçŸ¿-æ¹¿é‡ï¼ˆtï¼‰'] || 0;
    acc.oreDryWeight += item['æ°§åŒ–é”ŒåŸçŸ¿-å¹²é‡ï¼ˆtï¼‰'] || 0;
    
    // %å€¼ç´¯åŠ ï¼ˆåç»­è®¡ç®—å¹³å‡å€¼ï¼‰
    acc.moisture += item['æ°§åŒ–é”ŒåŸçŸ¿-æ°´ä»½ï¼ˆ%ï¼‰'] || 0;
    acc.orePbGrade += item['æ°§åŒ–é”ŒåŸçŸ¿-Pbå…¨å“ä½ï¼ˆ%ï¼‰'] || 0;
    
    acc.count += 1;
    return acc;
  }, {
    oreWetWeight: 0, oreDryWeight: 0, moisture: 0, orePbGrade: 0,
    count: 0
  });

  // è®¡ç®—å¹³å‡å€¼
  const avgMoisture = aggregated.count > 0 ? aggregated.moisture / aggregated.count : 0;
  const avgOrePbGrade = aggregated.count > 0 ? aggregated.orePbGrade / aggregated.count : 0;

  // æ„å»ºæŸ±çŠ¶å›¾æ•°æ®
  const recoveryData = [
    { name: 'æ°§åŒ–çŸ¿Znç†è®ºå›æ”¶ç‡', value: avgRecovery, unit: '%' }
  ];

  const oreData = [
    { name: 'æ¹¿é‡', value: aggregated.oreWetWeight / 20, unit: 't', originalValue: aggregated.oreWetWeight, isCompressed: true },
    { name: 'æ°´ä»½', value: avgMoisture, unit: '%' },
    // ... å…¶ä»–æ•°æ®
  ];

  return [recoveryData, oreData, concentrateData, tailingData];
}, [jdxyData, fdxData, klData, singleDate]);
```

### 3. å‰ç«¯çŠ¶æ€ç®¡ç†

#### å¤šç»´åº¦çŠ¶æ€ç®¡ç†
```typescript
// æ•°æ®çŠ¶æ€
const [jdxyData, setJdxyData] = useState<ShiftReportData[]>([]);
const [fdxData, setFdxData] = useState<ShiftReportData[]>([]);
const [klData, setKlData] = useState<ShiftReportData[]>([]);

// æ—¥æœŸçŠ¶æ€
const [trendStartDate, setTrendStartDate] = useState(() => {
  const date = new Date();
  date.setDate(date.getDate() - 30);
  return format(date, 'yyyy-MM-dd');
});
const [trendEndDate, setTrendEndDate] = useState(() => format(new Date(), 'yyyy-MM-dd'));

// åˆ†é¡µçŠ¶æ€
const [currentPage, setCurrentPage] = useState(1);
const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');

// åŠ è½½çŠ¶æ€
const [isLoading, setIsLoading] = useState(false);
```

#### æ•°æ®è·å–ç­–ç•¥
```typescript
const fetchShiftReportData = useCallback(async (startDate: string, endDate: string) => {
  setIsLoading(true);
  try {
    // å¹¶è¡Œè·å–ä¸‰ä¸ªæ•°æ®æº
    const [jdxyResult, fdxResult, klResult] = await Promise.all([
      fetch('/api/shift-report-details', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ startDate, endDate, dataSource: 'jdxy' })
      }),
      fetch('/api/shift-report-details', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ startDate, endDate, dataSource: 'fdx' })
      }),
      fetch('/api/shift-report-details', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ startDate, endDate, dataSource: 'kl' })
      })
    ]);

    // å¤„ç†å“åº”
    const [jdxyData, fdxData, klData] = await Promise.all([
      jdxyResult.json(),
      fdxResult.json(),
      klResult.json()
    ]);

    // æ›´æ–°çŠ¶æ€
    setJdxyData(jdxyData.success ? jdxyData.data : []);
    setFdxData(fdxData.success ? fdxData.data : []);
    setKlData(klData.success ? klData.data : []);

  } catch (error) {
    console.error('æ•°æ®è·å–å¤±è´¥:', error);
  } finally {
    setIsLoading(false);
  }
}, []);
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**ğŸ“Š ç´¢å¼•ç­–ç•¥**
```sql
-- ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_production_date ON "ç”Ÿäº§ç­æŠ¥-FDX" ("æ—¥æœŸ");
CREATE INDEX idx_production_shift ON "ç”Ÿäº§ç­æŠ¥-FDX" ("ç­æ¬¡");
CREATE INDEX idx_production_date_shift ON "ç”Ÿäº§ç­æŠ¥-FDX" ("æ—¥æœŸ", "ç­æ¬¡");
```

**ğŸ” æŸ¥è¯¢ä¼˜åŒ–**
```typescript
// ä½¿ç”¨ç²¾ç¡®çš„æ—¥æœŸèŒƒå›´
queryUrl += `&æ—¥æœŸ=gte.${startDate}&æ—¥æœŸ=lte.${endDate}T23:59:59.999Z`;

// é™åˆ¶è¿”å›å­—æ®µ
queryUrl += `&select=æ—¥æœŸ,ç­æ¬¡,æ°§åŒ–é”ŒåŸçŸ¿-æ¹¿é‡ï¼ˆtï¼‰,æ°§åŒ–é”ŒåŸçŸ¿-æ°´ä»½ï¼ˆ%ï¼‰`;

// åˆç†çš„åˆ†é¡µå¤§å°
queryUrl += `&limit=50&offset=${page * 50}`;
```

### 2. å‰ç«¯æ€§èƒ½ä¼˜åŒ–

**âš¡ Reactä¼˜åŒ–**
```typescript
// ä½¿ç”¨useCallbackç¼“å­˜å‡½æ•°
const processTrendData = useCallback(() => {
  // æ•°æ®å¤„ç†é€»è¾‘
}, [allData, trendStartDate, trendEndDate]);

// ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
const chartData = useMemo(() => {
  return processTrendData();
}, [processTrendData]);

// é˜²æŠ–å¤„ç†ç”¨æˆ·è¾“å…¥
const debouncedSearch = useMemo(
  () => debounce((searchTerm: string) => {
    // æœç´¢é€»è¾‘
  }, 300),
  []
);
```

**ğŸ”„ æ•°æ®ç¼“å­˜**
```typescript
// æœ¬åœ°ç¼“å­˜ç­–ç•¥
const cacheKey = `shift-report-${startDate}-${endDate}`;
const cachedData = localStorage.getItem(cacheKey);

if (cachedData && Date.now() - JSON.parse(cachedData).timestamp < 5 * 60 * 1000) {
  // ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
  return JSON.parse(cachedData).data;
}
```

## âš ï¸ é”™è¯¯å¤„ç†è§„èŒƒ

### 1. ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

```typescript
interface ErrorResponse {
  success: false;
  error: string;
  code?: string;
  details?: any;
}

interface SuccessResponse<T> {
  success: true;
  data: T;
  message?: string;
}
```

### 2. åˆ†å±‚é”™è¯¯å¤„ç†

**ğŸ”§ APIå±‚é”™è¯¯å¤„ç†**
```typescript
try {
  // æ•°æ®åº“æ“ä½œ
} catch (error) {
  console.error('æ•°æ®åº“æ“ä½œå¤±è´¥:', error);
  
  if (error.code === '23505') {
    return NextResponse.json({
      success: false,
      error: 'æ•°æ®å·²å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ—¥æœŸå’Œç­æ¬¡',
      code: 'DUPLICATE_ENTRY'
    }, { status: 409 });
  }
  
  return NextResponse.json({
    success: false,
    error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯',
    code: 'INTERNAL_ERROR'
  }, { status: 500 });
}
```

**ğŸ¯ å‰ç«¯é”™è¯¯å¤„ç†**
```typescript
try {
  const result = await SampleDataService.submitShiftSample(data);
  
  if (!result.success) {
    // ä¸šåŠ¡é€»è¾‘é”™è¯¯
    setSubmitStatus('error');
    setSubmitMessage(result.message);
    return;
  }
  
  // æˆåŠŸå¤„ç†
  setSubmitStatus('success');
  setSubmitMessage(result.message);
  
} catch (error) {
  // ç½‘ç»œæˆ–ç³»ç»Ÿé”™è¯¯
  console.error('æäº¤å¼‚å¸¸:', error);
  setSubmitStatus('error');
  setSubmitMessage('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•');
}
```

### 3. ç”¨æˆ·å‹å¥½çš„é”™è¯¯åé¦ˆ

```typescript
// é”™è¯¯æ¶ˆæ¯æ˜ å°„
const ERROR_MESSAGES = {
  'NETWORK_ERROR': 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•',
  'VALIDATION_ERROR': 'æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥è¾“å…¥',
  'DUPLICATE_ENTRY': 'æ•°æ®å·²å­˜åœ¨ï¼Œè¯·æ£€æŸ¥æ—¥æœŸå’Œç­æ¬¡',
  'PERMISSION_DENIED': 'æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜',
  'SERVER_ERROR': 'æœåŠ¡å™¨æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•'
};

const getErrorMessage = (error: any): string => {
  if (error.code && ERROR_MESSAGES[error.code]) {
    return ERROR_MESSAGES[error.code];
  }
  return error.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•';
};
```

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ğŸ”’ å®‰å…¨ç¬¬ä¸€**: ç¯å¢ƒå˜é‡éªŒè¯ã€è¾“å…¥éªŒè¯ã€SQLæ³¨å…¥é˜²æŠ¤
2. **ğŸ“Š æ€§èƒ½ä¼˜åŒ–**: æŸ¥è¯¢ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥ã€Reactä¼˜åŒ–
3. **ğŸ›¡ï¸ é”™è¯¯å¤„ç†**: åˆ†å±‚å¤„ç†ã€ç”¨æˆ·å‹å¥½ã€å®Œæ•´æ—¥å¿—
4. **ğŸ”„ å¯ç»´æŠ¤æ€§**: ç»Ÿä¸€æ¥å£ã€æ¨¡å—åŒ–è®¾è®¡ã€ç±»å‹å®‰å…¨
5. **ğŸ“± ç”¨æˆ·ä½“éªŒ**: åŠ è½½çŠ¶æ€ã€å®æ—¶åé¦ˆã€å“åº”å¼è®¾è®¡

### å¯å¤ç”¨çš„è®¾è®¡æ¨¡å¼

1. **æœåŠ¡å±‚æ¨¡å¼**: ç»Ÿä¸€çš„æ•°æ®æœåŠ¡æ¥å£
2. **çŠ¶æ€ç®¡ç†æ¨¡å¼**: å¤šç»´åº¦çŠ¶æ€åˆ†ç¦»
3. **é”™è¯¯å¤„ç†æ¨¡å¼**: åˆ†å±‚é”™è¯¯å¤„ç†æœºåˆ¶
4. **æ•°æ®èšåˆæ¨¡å¼**: çµæ´»çš„æ•°æ®å¤„ç†ç­–ç•¥
5. **APIè®¾è®¡æ¨¡å¼**: RESTfulé£æ ¼çš„ç»Ÿä¸€æ¥å£

è¿™äº›æœ€ä½³å®è·µä¸ºé¡¹ç›®çš„æ•°æ®åº“æ“ä½œæä¾›äº†åšå®çš„åŸºç¡€ï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚
