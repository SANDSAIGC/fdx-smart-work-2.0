# 压滤车间页面

## 📋 页面概述

压滤车间页面是FDX SMART WORK 2.0项目中用于记录和管理压滤设备操作的专用工作台。该页面基于机器运行记录页面的架构设计，提供了完整的压滤操作记录、查询和管理功能。

## 🎯 功能特性

### 1. **统计显示功能**
- **当日周期数**: 显示所选日期下所有班次提交记录次数总和
- **当班周期数**: 显示所选日期下所选班次提交记录次数总和
- **实时计算**: 统计数据根据日期和班次选择实时更新

### 2. **数据录入功能**
- **日期选择**: 支持选择记录日期（默认当前日期）
- **时间选择**: 支持精确到分钟的时间记录（默认当前时间）
- **班次选择**: 支持"早班"、"中班"和"夜班"三种班次，采用增强型UI设计
- **操作员**: 自动获取当前登录用户姓名（后台处理，无需用户输入）
- **图片上传**: 支持压滤操作照片记录，集成Supabase Storage存储方案

### 3. **历史记录查询**
- **数据展示**: 以表格形式展示历史记录
- **排序功能**: 按日期和时间倒序排列
- **班次标识**: 用不同颜色标识早班（蓝色）、中班（橙色）和夜班（紫色）
- **分页显示**: 每页显示10条记录，支持翻页
- **图片记录**: 显示是否包含操作照片

### 4. **数据管理功能**
- **新增记录**: 提交新的压滤操作记录
- **编辑记录**: 修改已有记录信息（预留功能）
- **删除记录**: 删除不需要的记录
- **实时同步**: 所有操作实时同步到Supabase数据库

## 🏗️ 技术架构

### 页面结构
```
/filter-press-workshop
├── page.tsx                 # 主页面组件
└── README.md               # 说明文档
```

### 数据库集成
- **数据表**: 连接到Supabase数据表"压滤记录"
- **字段映射**:
  - `日期` (date) - 记录日期
  - `时间` (time) - 记录时间
  - `班次` (text) - 早班/中班/夜班（支持三班制）
  - `操作员` (text) - 操作人员姓名（自动获取）
  - `照片url` (text, nullable) - 压滤操作照片Base64存储
  - `created_at` (timestamp) - 创建时间
  - `updated_at` (timestamp) - 更新时间

### 组件架构
- **Header1**: 标准化页面头部（汉堡菜单 + 居中标题 + 主题切换）
- **统计卡片**: 显示当日和当班周期数
- **表单组件**: 使用shadcn/ui组件构建
- **表格组件**: 分页显示历史记录
- **Footer**: 统一底部签名

## 🔧 核心功能实现

### 1. **数据同步机制**
```typescript
// 基于日期+班次的UPSERT逻辑
const recordData = {
  日期: date,
  时间: time,
  班次: shift,
  操作员: user.姓名 || user.name || '未知用户',
  照片url: null,
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString()
};
```

### 2. **统计计算逻辑**
```typescript
// 当日周期数：所选日期下所有班次提交记录次数总和
const dailyCount = allRecords.filter(record => record.日期 === selectedDate).length;

// 当班周期数：所选日期下所选班次提交记录次数总和
const shiftCount = allRecords.filter(record => 
  record.日期 === selectedDate && record.班次 === selectedShift
).length;
```

### 3. **分页处理**
- 每页显示10条记录
- 支持前后翻页
- 显示当前页码和总页数
- 显示记录范围和总数

## 📱 用户界面

### 页面布局
1. **Header区域**: 汉堡菜单 + 页面标题 + 主题切换
2. **统计卡片**: 当日周期数 + 当班周期数
3. **录入表单**: 日期 + 时间 + 班次 + 操作员
4. **历史记录**: 分页表格显示
5. **Footer**: 统一底部签名

### 响应式设计
- 移动端优化的表单布局
- 自适应的统计卡片网格
- 响应式表格显示

## 🚀 使用指南

### 1. **添加新记录**
1. 选择记录日期（默认当前日期）
2. 选择记录时间（默认当前时间）
3. 选择班次（早班/中班/夜班，采用增强型卡片式选择）
4. 上传操作照片（可选，支持预览和删除）
5. 点击"提交记录"按钮（操作员信息自动记录）

### 2. **查看历史记录**
- 页面自动加载最近的压滤记录
- 记录按日期和时间倒序排列
- 班次用不同颜色标识
- 支持分页浏览

### 3. **删除记录**
1. 点击记录行的"删除"按钮
2. 确认删除操作
3. 系统自动移除记录并刷新列表

### 4. **查看统计**
- 当日周期数：实时显示当天所有班次的记录总数
- 当班周期数：实时显示当前班次的记录总数
- 统计数据随日期和班次选择自动更新

### 5. **图片管理**
- 支持JPG、PNG、WEBP格式图片上传
- 最大文件大小限制10MB
- 图片预览功能，支持删除重新上传
- 使用Base64编码存储，确保数据完整性

## 🛠️ 开发指南

### 环境要求
- Node.js 18+
- Next.js 15+
- Supabase数据库
- TypeScript支持

### 本地开发
```bash
# 启动开发服务器
npm run dev

# 访问页面
http://localhost:3000/filter-press-workshop
```

### 数据库配置
确保Supabase中存在"压滤记录"数据表，包含以下字段：
- `id` (integer, primary key)
- `日期` (date, not null)
- `时间` (time, not null)
- `班次` (text, not null)
- `操作员` (text, not null)
- `照片url` (text, nullable)
- `created_at` (timestamp with time zone)
- `updated_at` (timestamp with time zone)

## 🔒 权限控制

### 访问权限
- 需要用户登录才能访问
- 支持所有角色用户使用
- 操作员字段自动记录当前用户

### 数据安全
- 使用Supabase API进行数据操作
- 支持RLS（行级安全）策略
- 所有操作都有错误处理和用户反馈

## 📊 数据流程

### 数据写入流程
1. 用户填写表单 → 2. 前端验证 → 3. 调用Supabase API → 4. 写入数据库 → 5. 刷新页面数据

### 数据读取流程
1. 页面加载 → 2. 获取用户信息 → 3. 查询历史记录 → 4. 计算统计数据 → 5. 渲染页面

### 统计计算流程
1. 监听日期/班次变化 → 2. 过滤相关记录 → 3. 计算周期数 → 4. 更新显示

## 🎨 设计规范

### 组件优先级
1. 现有预设组件
2. shadcn/ui标准组件
3. 自定义组件

### 图标规范
- 优先使用Lucide React图标库
- 统一图标尺寸（h-4 w-4 或 h-5 w-5）
- 确保语义匹配和专业性

### 样式规范
- 遵循项目统一的Tailwind CSS规范
- 支持明暗主题切换
- 保持与其他页面的视觉一致性

### 班次选择UI设计
- 采用卡片式布局，增强视觉层次感
- 不同班次使用不同主题色：
  - 早班：蓝色主题（08:00 - 16:00）
  - 中班：橙色主题（16:00 - 24:00）
  - 夜班：紫色主题（00:00 - 08:00）
- 选中状态有明显的视觉反馈
- 支持悬停效果和过渡动画

### 图片上传组件设计
- 拖拽式上传区域设计
- 图片预览功能
- 上传进度指示
- 错误处理和用户反馈
- 响应式设计，移动端优化

## 🔄 后续优化

### 计划功能
1. **照片上传**: 支持压滤操作照片记录
2. **数据导出**: 支持Excel格式导出
3. **高级筛选**: 按日期范围、操作员等条件筛选
4. **数据统计**: 更丰富的统计图表展示

### 性能优化
1. **虚拟滚动**: 处理大量历史记录
2. **缓存机制**: 减少重复数据请求
3. **懒加载**: 优化页面加载速度

---

**FDX@2025 滇ICP备2025058380号**
