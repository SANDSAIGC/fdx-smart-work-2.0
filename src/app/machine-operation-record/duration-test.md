# 机器运行记录持续时长计算逻辑测试

## 测试目标
验证重新设计的持续时长计算逻辑是否正确工作

## 核心计算原则
1. **持续时长定义**: 表示当前记录的设备状态持续了多长时间，直到下一个状态变化为止
2. **有后续记录**: 持续时长 = 下一条记录的时间 - 当前记录的时间
3. **最新记录**: 持续时长设为 NULL，显示为"--"
4. **时间计算**: 支持跨日期计算
5. **异常处理**: 时间差为负数或超过24小时时设为NULL

## 测试数据
```
记录1: 2025-07-02 08:00 正常运行 (张三)
记录2: 2025-07-02 12:00 正常运行 (李四)  
记录3: 2025-07-02 16:00 设备维护 (王五)
记录4: 2025-07-02 18:30 正常运行 (赵六)
记录5: 2025-07-03 08:00 正常运行 (楚留香) [最新记录]
```

## 预期计算结果
- **记录5** (2025-07-03 08:00): 持续时长 = "--" (最新记录)
- **记录4** (2025-07-02 18:30): 持续时长 = "13小时30分钟" (到次日08:00)
- **记录3** (2025-07-02 16:00): 持续时长 = "2小时30分钟" (到18:30)
- **记录2** (2025-07-02 12:00): 持续时长 = "4小时" (到16:00)
- **记录1** (2025-07-02 08:00): 持续时长 = "4小时" (到12:00)

## 测试步骤
1. 访问机器运行记录页面
2. 查看历史记录表格中的持续时长列
3. 验证最新记录显示为"--"
4. 验证其他记录的持续时长计算是否正确
5. 添加新记录，验证持续时长是否重新计算

## 验证要点
- [x] 设备状态选择器可以正常切换
- [x] 历史记录按日期倒序排列
- [x] 持续时长计算逻辑正确
- [x] 最新记录显示"--"
- [x] 跨日期时长计算正确
- [x] 编辑功能中持续时长为只读
- [x] 新增记录后自动重新计算所有持续时长

## 实现特点
1. **前端计算**: 所有持续时长在前端动态计算，不依赖数据库存储
2. **实时更新**: 新增或编辑记录后自动重新计算
3. **智能排序**: 先按时间正序计算，再按时间倒序显示
4. **异常处理**: 处理时间差异常情况
5. **用户友好**: 格式化显示为"X小时Y分钟"格式
