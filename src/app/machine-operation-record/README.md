# 机器运行记录页面

## 📋 页面概述

机器运行记录页面是FDX SMART WORK 2.0项目中用于记录和管理机器设备运行状态的专用工作台。该页面提供了完整的设备状态记录、查询和管理功能。

## 🎯 功能特性

### 1. **数据录入功能**
- **日期选择**: 支持选择记录日期
- **时间选择**: 支持精确到分钟的时间记录
- **设备状态**: 支持"正常运行"和"设备维护"两种状态
- **操作人员**: 自动获取当前登录用户姓名

### 2. **历史记录查询**
- **数据展示**: 以表格形式展示历史记录
- **排序功能**: 按日期和时间倒序排列
- **状态图标**: 直观显示设备运行状态
- **操作按钮**: 支持编辑和删除记录

### 3. **数据管理功能**
- **新增记录**: 提交新的运行记录
- **编辑记录**: 修改已有记录信息
- **删除记录**: 删除不需要的记录
- **实时同步**: 所有操作实时同步到数据库

## 🏗️ 技术架构

### 页面结构
```
/machine-operation-record
├── page.tsx                 # 主页面组件
├── README.md               # 说明文档
└── /api/machine-operation-record
    └── route.ts            # API路由处理
```

### 数据库表结构
```sql
机器运行记录 (
    id UUID PRIMARY KEY,
    日期 DATE NOT NULL,
    时间 TIME NOT NULL,
    设备状态 TEXT CHECK (设备状态 IN ('正常运行', '设备维护')),
    操作人员 TEXT NOT NULL,
    创建时间 TIMESTAMPTZ DEFAULT NOW(),
    更新时间 TIMESTAMPTZ DEFAULT NOW()
)
```

### API接口
- `GET /api/machine-operation-record` - 获取记录列表
- `POST /api/machine-operation-record` - 创建新记录
- `PUT /api/machine-operation-record` - 更新记录
- `DELETE /api/machine-operation-record?id={id}` - 删除记录

## 🎨 UI设计规范

### Header布局
- **左侧**: 返回按钮 + 页面标题 (space-x-4间距)
- **右侧**: 主题切换 + 汉堡菜单 (space-x-2间距)
- **样式**: h-14高度，container flex items-center

### 表单设计
- **日期选择器**: Input + type='date'，参考filter-press-workshop页面标准
- **时间选择器**: Input + type='time'，HH:MM格式
- **状态选择**: Select下拉框，默认"正常运行"
- **提交按钮**: 包含加载状态和成功反馈

### 图标规范
- 使用Lucide React图标库
- 避免使用表情符号
- 保持图标尺寸一致性(h-4 w-4或h-5 w-5)
- 确保语义匹配和专业性

## 📱 响应式设计

### 移动端适配
- 表单字段在小屏幕上垂直排列
- 表格支持水平滚动
- 按钮和输入框适配触摸操作
- 保持良好的可读性和可操作性

### 桌面端优化
- 表单字段采用网格布局
- 表格完整显示所有列
- 鼠标悬停效果
- 键盘快捷键支持

## 🔧 使用方法

### 1. **添加新记录**
1. 选择记录日期（默认当前日期）
2. 选择记录时间（默认当前时间）
3. 选择设备状态（正常运行/设备维护）
4. 确认操作人员（自动填充当前用户）
5. 点击"提交记录"按钮

### 2. **查看历史记录**
- 页面自动加载最近的运行记录
- 记录按日期和时间倒序排列
- 设备状态用图标和颜色区分
- 支持查看详细的操作信息

### 3. **编辑记录**
1. 点击记录行的"编辑"按钮
2. 在弹出对话框中修改信息
3. 点击"更新记录"保存修改
4. 系统自动刷新记录列表

### 4. **删除记录**
1. 点击记录行的"删除"按钮
2. 确认删除操作
3. 系统自动移除记录并刷新列表

## 🛠️ 开发指南

### 环境要求
- Node.js 18+
- Next.js 15+
- Supabase数据库
- TypeScript支持

### 本地开发
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问页面
http://localhost:3000/machine-operation-record
```

### 数据库初始化
```bash
# 执行SQL脚本
psql -f src/scripts/init-machine-operation-record-table.sql

# 或运行TypeScript脚本
npx tsx src/scripts/init-machine-operation-record.ts
```

## 🔒 权限控制

### 访问权限
- 需要用户登录才能访问
- 支持所有角色用户使用
- 操作人员字段自动记录当前用户

### 数据权限
- 所有用户可查看所有记录
- 所有用户可添加新记录
- 所有用户可编辑和删除记录
- 支持行级安全策略(RLS)

## 📊 数据统计

### 统计视图
- `机器运行记录统计`: 按日期统计运行情况
- `最近机器运行记录`: 显示最近50条记录

### 统计指标
- 总记录数
- 正常运行次数
- 设备维护次数
- 正常运行率(%)

## 🚀 部署说明

### 生产环境配置
1. 确保Supabase环境变量正确配置
2. 执行数据库初始化脚本
3. 验证API接口正常工作
4. 测试页面功能完整性

### 监控和维护
- 定期检查数据库连接状态
- 监控API响应时间
- 备份重要运行记录数据
- 定期清理过期记录

## 📞 技术支持

如有问题或建议，请联系开发团队：
- 项目: FDX SMART WORK 2.0
- 版权: FDX@2025 滇ICP备2025058380号
