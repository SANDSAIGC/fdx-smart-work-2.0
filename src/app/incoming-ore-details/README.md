# 进厂原矿详情页面

## 📋 页面概述

进厂原矿详情页面是FDX SMART WORK 2.0项目中的重要功能模块，用于展示和管理进厂原矿的详细数据，包括趋势分析、单日详情和数据汇总功能。

## 🎯 功能特性

### 1. 页面结构
- **Header组件**: 使用Header-2组件，包含返回按钮和页面标题
- **三大内容区域**: 趋势总览、单日详情、数据汇总
- **Footer组件**: 统一的底部签名

### 2. 核心功能

#### PART1: 进厂趋势总览
- **日期范围选择器**: 支持起始日期和结束日期选择
- **趋势图卡片**: 响应式网格布局（WEB端4列，移动端2列）
- **四个关键指标**:
  - 进厂湿重(t)
  - 水份(%)
  - 原矿Pb品位(%)
  - 原矿Zn品位(%)
- **数据源对比**: 每个指标显示富鼎翔和金鼎两个数据源
- **图表类型**: Bar Chart - Stacked + Legend

#### PART2: 进厂单日详情
- **日期选择器**: 单日期选择
- **甜甜圈图表**: 响应式网格布局（WEB端4列，移动端2列）
- **四个关键指标**: 与趋势图相同
- **数据展示**: 中心直接显示数值和单位
- **百分比填充**: 基于最大值计算（湿重/8000t，品位/50%）
- **进度条**: 显示当前值占最大值的比例

#### PART3: 进厂数据汇总
- **日期范围选择器**: 支持数据筛选
- **数据表格**: 显示详细的进厂原矿记录
- **表格字段**:
  - 操作按钮（编辑、删除）
  - 日期
  - 数据源（富鼎翔/金鼎）
  - 进厂湿重(t)
  - 水份(%)
  - 原矿Pb品位(%)
  - 原矿Zn品位(%)
- **数据管理**: 支持编辑和删除操作

### 3. 数据管理功能

#### 编辑功能
- **编辑对话框**: 模态框形式的编辑界面
- **字段编辑**: 支持修改湿重、水份、Pb品位、Zn品位
- **数据验证**: 数值类型验证和范围检查
- **实时更新**: 保存后立即刷新页面数据

#### 删除功能
- **确认对话框**: 删除前需要用户确认
- **安全删除**: 防止误操作
- **即时反馈**: 删除后立即更新列表

## 🔧 技术实现

### 1. 组件架构
```
进厂原矿详情页面
├── Header2 (页面头部)
├── 趋势总览区域
│   ├── 日期范围选择器
│   └── 4个Bar Chart组件
├── 单日详情区域
│   ├── 日期选择器
│   └── 4个DonutChart组件
├── 数据汇总区域
│   ├── 日期范围选择器
│   ├── 数据表格
│   └── 编辑对话框
└── Footer (页面底部)
```

### 2. 数据流架构
```
前端页面 ←→ API路由 ←→ Supabase数据库
    ↓           ↓           ↓
页面状态    数据处理    进厂原矿-FDX
组件渲染    错误处理    进厂原矿-JDXY
用户交互    响应格式    数据存储
```

### 3. API端点

#### 数据获取
- `POST /api/lab/fdx-data` - 获取富鼎翔数据
- `POST /api/lab/jdxy-data` - 获取金鼎数据
- `POST /api/incoming-ore-details` - 获取指定数据源数据

#### 数据管理
- `PUT /api/incoming-ore-details` - 更新数据记录
- `DELETE /api/incoming-ore-details` - 删除数据记录

### 4. 数据表结构

#### 进厂原矿-FDX表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 主键 |
| 计量日期 | DATE | 计量日期 |
| 进厂湿重 | NUMERIC | 进厂湿重(吨) |
| 水份(%) | NUMERIC | 水份百分比 |
| Pb | NUMERIC | 铅品位百分比 |
| Zn | NUMERIC | 锌品位百分比 |
| 供应商 | TEXT | 供应商名称 |
| 原矿类型 | TEXT | 原矿类型 |

#### 进厂原矿-JDXY表
结构与FDX表相同，用于存储金鼎锌业数据。

## 📱 响应式设计

### 移动端适配
- **网格布局**: 自动调整为2列显示
- **图表尺寸**: 适配小屏幕显示
- **触摸优化**: 按钮和交互元素适合触摸操作
- **滚动优化**: 表格支持横向滚动

### 桌面端优化
- **多列布局**: 充分利用屏幕空间
- **鼠标交互**: 悬停效果和右键菜单
- **键盘导航**: 支持Tab键导航

## 🎨 设计规范

### 图标使用
- **统一图标库**: Lucide React图标库
- **图标尺寸**: h-4 w-4 或 h-5 w-5
- **语义化图标**: 
  - BarChart3: 趋势分析
  - PieChartIcon: 单日详情
  - TableIcon: 数据汇总
  - Calendar: 日期选择
  - Edit: 编辑操作
  - Trash2: 删除操作

### 颜色方案
- **主色调**: var(--chart-1) 到 var(--chart-4)
- **状态颜色**: 
  - 成功: var(--success)
  - 警告: var(--warning)
  - 错误: var(--destructive)
- **数据源区分**:
  - 富鼎翔: var(--chart-1)
  - 金鼎: var(--chart-2)

## 🚀 使用指南

### 1. 访问页面
```
http://localhost:3000/incoming-ore-details
```

### 2. 查看趋势
1. 选择起始日期和结束日期
2. 查看四个指标的趋势图
3. 对比富鼎翔和金鼎数据

### 3. 查看单日详情
1. 选择特定日期
2. 查看当日四个指标的甜甜圈图
3. 观察数据填充比例和进度

### 4. 管理数据
1. 在数据汇总区域查看记录列表
2. 点击编辑按钮修改数据
3. 点击删除按钮移除记录
4. 使用日期筛选查看特定时间段数据

## 🔍 测试和调试

### 测试页面
访问 `http://localhost:3000/test-incoming-ore` 查看数据连接测试结果。

### 调试工具
- 浏览器开发者工具查看网络请求
- 控制台日志查看数据流
- React DevTools查看组件状态

## 📝 开发注意事项

### 1. 数据处理
- 确保数值类型正确转换
- 处理空值和异常数据
- 保持字段名称一致性

### 2. 性能优化
- 使用useCallback优化函数
- 合理使用useMemo缓存计算结果
- 避免不必要的重新渲染

### 3. 错误处理
- API调用异常处理
- 用户输入验证
- 网络连接错误提示

## 🔄 后续优化

### 功能增强
- [ ] 数据导出功能
- [ ] 批量编辑功能
- [ ] 数据对比分析
- [ ] 历史趋势预测

### 性能优化
- [ ] 数据分页加载
- [ ] 图表懒加载
- [ ] 缓存机制优化

### 用户体验
- [ ] 快捷键支持
- [ ] 拖拽排序
- [ ] 自定义图表配置

---

**版权信息**: FDX@2025 滇ICP备2025058380号
