# ç»„ä»¶åŒ–æ¶æ„å®æ–½æŒ‡å—

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### åˆ›å»ºæ–°é¡µé¢çš„æ ‡å‡†æµç¨‹

#### æ­¥éª¤ 1ï¼šåˆ›å»ºè·¯ç”±é¡µé¢æ–‡ä»¶
```bash
# åˆ›å»ºè·¯ç”±ç›®å½•å’Œæ–‡ä»¶
mkdir app/new-feature
touch app/new-feature/page.tsx
```

```typescript
// app/new-feature/page.tsx
import { NewFeaturePage } from "@/components/new-feature-page";
import { AuthGuard } from "@/components/auth-guard";

export default function Page() {
  return (
    <AuthGuard requireAuth={true}>
      <NewFeaturePage />
    </AuthGuard>
  );
}
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºä¸šåŠ¡ç»„ä»¶æ–‡ä»¶
```bash
# åˆ›å»ºç»„ä»¶æ–‡ä»¶
touch components/new-feature-page.tsx
```

```typescript
// components/new-feature-page.tsx
"use client";

import React, { useState, useCallback, memo } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

// ç±»å‹å®šä¹‰
interface NewFeaturePageProps {
  mode?: 'full' | 'mini' | 'readonly';
  onDataChange?: (data: any) => void;
}

// ç»„ä»¶å®ç°
export const NewFeaturePage = memo(({ 
  mode = 'full',
  onDataChange 
}: NewFeaturePageProps) => {
  // çŠ¶æ€ç®¡ç†
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);

  // äº‹ä»¶å¤„ç†
  const handleSubmit = useCallback(async () => {
    setLoading(true);
    try {
      // ä¸šåŠ¡é€»è¾‘å®ç°
      console.log('æäº¤æ•°æ®:', data);
      onDataChange?.(data);
    } catch (error) {
      console.error('æäº¤å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }, [data, onDataChange]);

  // æ¸²æŸ“é€»è¾‘
  return (
    <div className="container mx-auto p-4">
      <Card>
        <CardHeader>
          <CardTitle>æ–°åŠŸèƒ½é¡µé¢</CardTitle>
        </CardHeader>
        <CardContent>
          <Button 
            onClick={handleSubmit} 
            disabled={loading}
          >
            {loading ? 'æäº¤ä¸­...' : 'æäº¤'}
          </Button>
        </CardContent>
      </Card>
    </div>
  );
});

NewFeaturePage.displayName = 'NewFeaturePage';
```

#### æ­¥éª¤ 3ï¼šé…ç½®è·¯ç”±ï¼ˆå¦‚éœ€è¦ï¼‰
```typescript
// lib/route-config.ts
export const routes = [
  // ... å…¶ä»–è·¯ç”±
  {
    path: '/new-feature',
    name: 'new-feature',
    authStrategy: AuthStrategy.SIMPLE,
    pageType: 'business' as const,
    title: 'æ–°åŠŸèƒ½',
    description: 'æ–°åŠŸèƒ½é¡µé¢æè¿°'
  },
];
```

## ğŸ”§ å¼€å‘è§„èŒƒ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

```bash
# è·¯ç”±é¡µé¢æ–‡ä»¶
app/feature-name/page.tsx

# ä¸šåŠ¡ç»„ä»¶æ–‡ä»¶
components/feature-name-page.tsx

# å­ç»„ä»¶æ–‡ä»¶
components/feature-name-card.tsx
components/feature-name-dialog.tsx

# å·¥å…·å‡½æ•°æ–‡ä»¶
lib/feature-name-utils.ts

# ç±»å‹å®šä¹‰æ–‡ä»¶
types/feature-name.ts
```

### 2. ç»„ä»¶ç»“æ„æ¨¡æ¿

```typescript
// æ ‡å‡†ç»„ä»¶ç»“æ„æ¨¡æ¿
"use client";

import React, { useState, useCallback, memo, useEffect } from "react";
// UIç»„ä»¶å¯¼å…¥
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
// å·¥å…·å‡½æ•°å¯¼å…¥
import { cn } from "@/lib/utils";
// ç±»å‹å¯¼å…¥
import type { ComponentProps } from "@/types/component";

// 1. ç±»å‹å®šä¹‰
interface ComponentPageProps {
  mode?: 'full' | 'mini' | 'readonly';
  className?: string;
  onSubmit?: (data: any) => Promise<void>;
  onCancel?: () => void;
}

// 2. ç»„ä»¶å®ç°
export const ComponentPage = memo(({ 
  mode = 'full',
  className,
  onSubmit,
  onCancel 
}: ComponentPageProps) => {
  // 3. çŠ¶æ€ç®¡ç†
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  // 4. å‰¯ä½œç”¨å¤„ç†
  useEffect(() => {
    // ç»„ä»¶æŒ‚è½½æ—¶çš„åˆå§‹åŒ–é€»è¾‘
    return () => {
      // ç»„ä»¶å¸è½½æ—¶çš„æ¸…ç†é€»è¾‘
    };
  }, []);

  // 5. äº‹ä»¶å¤„ç†å‡½æ•°
  const handleSubmit = useCallback(async () => {
    if (!data) return;
    
    setLoading(true);
    setError(null);
    
    try {
      await onSubmit?.(data);
    } catch (err) {
      setError(err as Error);
    } finally {
      setLoading(false);
    }
  }, [data, onSubmit]);

  // 6. æ¸²æŸ“é€»è¾‘
  if (error) {
    return (
      <div className="error-container">
        <p>å‘ç”Ÿé”™è¯¯: {error.message}</p>
        <Button onClick={() => setError(null)}>é‡è¯•</Button>
      </div>
    );
  }

  return (
    <div className={cn("component-container", className)}>
      <Card>
        {/* ç»„ä»¶å†…å®¹ */}
        <Button 
          onClick={handleSubmit} 
          disabled={loading}
        >
          {loading ? 'å¤„ç†ä¸­...' : 'æäº¤'}
        </Button>
      </Card>
    </div>
  );
});

// 7. ç»„ä»¶æ˜¾ç¤ºåç§°
ComponentPage.displayName = 'ComponentPage';
```

### 3. è·¯ç”±é¡µé¢æ¨¡æ¿

```typescript
// æ ‡å‡†è·¯ç”±é¡µé¢æ¨¡æ¿
import { ComponentPage } from "@/components/component-page";
import { AuthGuard } from "@/components/auth-guard";
import { ErrorBoundary } from "@/components/error-boundary";
import { Suspense } from "react";
import { LoadingTransition } from "@/components/loading-transition";

export default function Page() {
  return (
    <ErrorBoundary>
      <AuthGuard requireAuth={true}>
        <Suspense fallback={<LoadingTransition />}>
          <ComponentPage />
        </Suspense>
      </AuthGuard>
    </ErrorBoundary>
  );
}
```

## ğŸ¨ å¸¸ç”¨æ¨¡å¼

### 1. è¡¨å•é¡µé¢æ¨¡å¼

```typescript
export const FormPage = memo(() => {
  const [formData, setFormData] = useState(initialFormData);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [submitStatus, setSubmitStatus] = useState<'idle' | 'success' | 'error'>('idle');

  const updateFormField = useCallback((field: string, value: any) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const handleSubmit = useCallback(async () => {
    setIsSubmitting(true);
    try {
      // æäº¤é€»è¾‘
      setSubmitStatus('success');
    } catch (error) {
      setSubmitStatus('error');
    } finally {
      setIsSubmitting(false);
    }
  }, [formData]);

  return (
    <form onSubmit={handleSubmit}>
      {/* è¡¨å•å†…å®¹ */}
    </form>
  );
});
```

### 2. æ•°æ®å±•ç¤ºé¡µé¢æ¨¡å¼

```typescript
export const DataPage = memo(() => {
  const [data, setData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const fetchData = useCallback(async () => {
    setLoading(true);
    try {
      const response = await api.getData();
      setData(response.data);
    } catch (err) {
      setError(err);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  if (loading) return <LoadingTransition />;
  if (error) return <ErrorDisplay error={error} onRetry={fetchData} />;

  return (
    <div>
      {/* æ•°æ®å±•ç¤ºå†…å®¹ */}
    </div>
  );
});
```

### 3. å¯¹è¯æ¡†ç»„ä»¶æ¨¡å¼

```typescript
export const DialogPage = memo(() => {
  const [dialogOpen, setDialogOpen] = useState(false);
  const [selectedItem, setSelectedItem] = useState(null);

  const handleItemClick = useCallback((item) => {
    setSelectedItem(item);
    setDialogOpen(true);
  }, []);

  const handleDialogClose = useCallback(() => {
    setDialogOpen(false);
    setSelectedItem(null);
  }, []);

  return (
    <div>
      {/* ä¸»è¦å†…å®¹ */}
      
      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>
        <DialogContent>
          {/* å¯¹è¯æ¡†å†…å®¹ */}
        </DialogContent>
      </Dialog>
    </div>
  );
});
```

## ğŸ” è°ƒè¯•å’Œæµ‹è¯•

### 1. ç»„ä»¶è°ƒè¯•

```typescript
// å¼€å‘ç¯å¢ƒè°ƒè¯•ä¿¡æ¯
export const DebugInfo = memo(({ componentName, data }) => {
  if (process.env.NODE_ENV !== 'development') return null;
  
  return (
    <div className="debug-info">
      <h4>è°ƒè¯•ä¿¡æ¯ - {componentName}</h4>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
});

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
export const ComponentPage = memo(() => {
  const [data, setData] = useState(null);
  
  return (
    <div>
      {/* ç»„ä»¶å†…å®¹ */}
      <DebugInfo componentName="ComponentPage" data={data} />
    </div>
  );
});
```

### 2. æ€§èƒ½ç›‘æ§

```typescript
// æ€§èƒ½ç›‘æ§ Hook
const usePerformanceMonitor = (componentName: string) => {
  const renderCount = useRef(0);
  const startTime = useRef(Date.now());
  
  useEffect(() => {
    renderCount.current += 1;
    const renderTime = Date.now() - startTime.current;
    
    if (process.env.NODE_ENV === 'development') {
      console.log(`${componentName} æ¸²æŸ“æ¬¡æ•°: ${renderCount.current}, æ¸²æŸ“æ—¶é—´: ${renderTime}ms`);
    }
  });
  
  return { renderCount: renderCount.current };
};

// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
export const ComponentPage = memo(() => {
  const { renderCount } = usePerformanceMonitor('ComponentPage');
  
  return (/* ç»„ä»¶å†…å®¹ */);
});
```

### 3. å•å…ƒæµ‹è¯•

```typescript
// __tests__/component-page.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { ComponentPage } from '@/components/component-page';

describe('ComponentPage', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“ç»„ä»¶', () => {
    render(<ComponentPage />);
    expect(screen.getByText('ç»„ä»¶æ ‡é¢˜')).toBeInTheDocument();
  });

  it('åº”è¯¥å¤„ç†ç”¨æˆ·äº¤äº’', async () => {
    const onSubmit = jest.fn();
    render(<ComponentPage onSubmit={onSubmit} />);
    
    fireEvent.click(screen.getByText('æäº¤'));
    
    await waitFor(() => {
      expect(onSubmit).toHaveBeenCalled();
    });
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†é”™è¯¯çŠ¶æ€', () => {
    const error = new Error('æµ‹è¯•é”™è¯¯');
    render(<ComponentPage error={error} />);
    
    expect(screen.getByText('å‘ç”Ÿé”™è¯¯: æµ‹è¯•é”™è¯¯')).toBeInTheDocument();
  });
});
```

## âš ï¸ å¸¸è§é—®é¢˜

### 1. ç»„ä»¶å¯¼å…¥é”™è¯¯
```typescript
// âŒ é”™è¯¯çš„å¯¼å…¥æ–¹å¼
import ShiftSamplePage from "@/components/shift-sample-page";

// âœ… æ­£ç¡®çš„å¯¼å…¥æ–¹å¼
import { ShiftSamplePage } from "@/components/shift-sample-page";
```

### 2. çŠ¶æ€ç®¡ç†é—®é¢˜
```typescript
// âŒ é¿å…åœ¨è·¯ç”±é¡µé¢ä¸­ç®¡ç†çŠ¶æ€
export default function Page() {
  const [data, setData] = useState(); // âŒ
  return <ComponentPage data={data} />;
}

// âœ… åœ¨ä¸šåŠ¡ç»„ä»¶ä¸­ç®¡ç†çŠ¶æ€
export const ComponentPage = memo(() => {
  const [data, setData] = useState(); // âœ…
  return (/* ç»„ä»¶å†…å®¹ */);
});
```

### 3. æ€§èƒ½ä¼˜åŒ–é—æ¼
```typescript
// âŒ ç¼ºå°‘ memo ä¼˜åŒ–
export const ComponentPage = () => {
  return (/* ç»„ä»¶å†…å®¹ */);
};

// âœ… ä½¿ç”¨ memo ä¼˜åŒ–
export const ComponentPage = memo(() => {
  return (/* ç»„ä»¶å†…å®¹ */);
});
```

## ğŸ¯ æ£€æŸ¥æ¸…å•

### æ–°é¡µé¢å¼€å‘æ£€æŸ¥æ¸…å•
- [ ] è·¯ç”±é¡µé¢æ–‡ä»¶å¤§å° < 20 è¡Œ
- [ ] ä¸šåŠ¡ç»„ä»¶ä½¿ç”¨ memo åŒ…è£…
- [ ] ç»„ä»¶ Props æœ‰å®Œæ•´ç±»å‹å®šä¹‰
- [ ] åŒ…å«é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] æ·»åŠ  displayName å±æ€§
- [ ] éµå¾ªå‘½åè§„èŒƒ
- [ ] åŒ…å«å¿…è¦çš„æ³¨é‡Š
- [ ] é€šè¿‡ ESLint æ£€æŸ¥
- [ ] é€šè¿‡ TypeScript æ£€æŸ¥
- [ ] ç¼–å†™åŸºç¡€å•å…ƒæµ‹è¯•

è¿™ä¸ªå®æ–½æŒ‡å—ä¸ºå›¢é˜Ÿæä¾›äº†æ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹å’Œæœ€ä½³å®è·µï¼Œç¡®ä¿æ‰€æœ‰å¼€å‘è€…éƒ½èƒ½æ­£ç¡®å®æ–½ç»„ä»¶åŒ–æ¶æ„ã€‚
